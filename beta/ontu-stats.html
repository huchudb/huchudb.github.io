<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>대출 통계 | 온투업 P2P 담보대출 통계 상세</title>
  <meta name="description" content="온라인투자연계금융업(P2P) 담보대출의 누적 대출금액, 상환금액, 대출잔액과 상품유형별 대출잔액을 월별로 확인할 수 있는 대출 통계 페이지입니다.">
  <meta name="robots" content="noindex, nofollow" />
  <link rel="stylesheet" href="/assets/styles.css?v=20251203-ontu-stats-final" />
</head>
<body class="beta-body ontu-stats-page">

  <!-- 상단 헤더 -->
  <header class="huchu-header beta-header" role="banner">
    <div class="huchu-header__inner beta-header__inner">
      <a href="/" class="huchu-logo" aria-label="후추 Huchu 홈">
        <img class="logo-img" src="/assets/logo/huchu-logo.png" alt="후추 로고" />
        <span class="logo-fallback">
          <span class="logo-mark">%</span>
          <span class="logo-text">후추 Huchu</span>
        </span>
      </a>

      <!-- MENU + 드롭다운 -->
      <button id="betaMenuToggle"
              class="beta-menu-toggle"
              type="button"
              aria-haspopup="true"
              aria-expanded="false">
        <span class="beta-menu-toggle__label">MENU</span>
      </button>

      <div id="betaMenuPanel" class="beta-menu-panel hide">
        <a class="beta-menu-link" href="/beta/ontu-stats.html">온투업 대출 통계</a>
        <a class="beta-menu-link" href="/beta/products/index.html">온투업 대출상품 정보</a>
        <a class="beta-menu-link" href="/">담보대출 계산기</a>
        <a class="beta-menu-link" href="/company.html">회사소개</a>
        <a class="beta-menu-link" href="/contact.html">광고문의</a>
        <a class="beta-menu-link" href="/beta/admin-beta.html">관리자</a>
      </div>
    </div>
  </header>

  <main class="beta-inner">
    <!-- 상단 타이틀 + 기준월 선택 -->
    <section class="beta-section beta-section--filter">
      <div class="beta-stats-header">
        <div class="beta-stats-header__left">
          <div class="beta-stats-header__top-row">
            <h1 class="beta-stats-title">대출 통계</h1>
            <div class="beta-month-picker">
              <label for="ontuMonthInput" class="beta-month-picker__label">기준월</label>
              <input
                type="month"
                id="ontuMonthInput"
                name="ontuMonthInput"
                aria-label="기준월 선택"
              />
            </div>
          </div>
          <p class="beta-stats-subtitle">
            전체 온라인투자연계금융업(P2P)의 대출 현황을 확인할 수 있습니다.
          </p>
        </div>
      </div>
    </section>

    <!-- 대출 현황 패널 -->
    <section class="beta-section">
      <div class="stats-panel stats-panel--loan">
        <div class="stats-panel__header">
          <h2 class="stats-panel__title">대출 현황</h2>
          <!-- 패널 내부의 'YYYY년 M월 기준' 텍스트 제거: stats-panel__meta 삭제 -->
        </div>

        <div class="stats-panel__body stats-panel__slider stats-panel__slider--loan">
          <div class="stats-panel__viewport">
            <div class="stats-panel__track stats-panel__track--loan" id="ontuLoanTrack">
              <!-- JS에서 카드 삽입 -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 상품유형별 대출잔액 패널 -->
    <section class="beta-section">
      <div class="stats-panel stats-panel--products">
        <div class="stats-panel__header">
          <h2 class="stats-panel__title">상품유형별 대출잔액</h2>
          <!-- 패널 내부의 'YYYY년 M월 기준' 텍스트 제거: stats-panel__meta 삭제 -->
        </div>

        <div class="stats-panel__body stats-panel__slider stats-panel__slider--products">
          <div class="stats-panel__viewport">
            <div class="stats-panel__track stats-panel__track--products" id="ontuProductTrack">
              <!-- JS에서 카드 삽입 -->
            </div>
          </div>
        </div>
      </div>
    </section>
     <!-- 여기 아래에 출처 텍스트 추가 -->
    <div class="ontu-source-note">
      ※출처: 온라인투자연계금융업 중앙기록관리기관
   </main>

  <!-- 공통 푸터 -->
  <footer class="beta-footer" role="contentinfo">
    <div class="beta-footer__top">
      <a href="/company.html">회사소개</a>
      <a href="/terms.html">서비스이용약관</a>
      <a href="/privacy.html">개인정보 취급방침</a>
    </div>
    <div class="beta-footer__bottom">
      <div class="beta-footer__brand">
        <img src="/assets/logo/huchu-logo-white.png"
             alt="HUCHU 로고"
             class="beta-footer__logo-img" />
        <span class="beta-footer__logo-text">HUCHU</span>
      </div>
      <div class="beta-footer__info">
        <p>상호: (예시) 후추랩 | 대표: 장현성</p>
        <p>주소: (예시) 경기도 고양시 일산동구 00로 00</p>
        <p>E-MAIL: huchudb01@gmail.com | 사업자번호: 000-00-00000</p>
        <p>2025 © HUCHU. ALL RIGHTS RESERVED.</p>
      </div>
    </div>
  </footer>

  <script src="/assets/ontu-stats.js?v=20251203-auto"></script>

  <!-- 온투 통계: 금액/단위 래핑 + 자동 슬라이드/드래그 후처리 -->
  <script>
    (function () {
      // 메인 금액 텍스트를 숫자/단위로 쪼개서 span으로 감싸기
      function decorateMoneySpans() {
        const selectors =
          '.stats-panel--loan .stats-card__value--main, ' +
          '.stats-panel--products .stats-card__value--main';

        const nodes = document.querySelectorAll(selectors);
        if (!nodes.length) return;

        nodes.forEach((node) => {
          // 첫 카드(데이터수집 온투업체수)는 지금 잘 나오니 건너뜀
          const isLoanPanel = node.closest('.stats-panel--loan');
          const card = node.closest('.stats-card');
          if (isLoanPanel && card && card === card.parentElement.firstElementChild) {
            return;
          }

          // 이미 래핑돼 있으면 패스
          if (node.querySelector('.money-number') || node.querySelector('.money-unit')) {
            return;
          }

          const raw = node.textContent.trim();
          if (!raw) return;

          // "18조 3,580억 234만원" → ["18조", "3,580억", "234만원"]
          const tokens = raw.split(/\s+/);
          const htmlTokens = tokens.map((tok) => {
            // "18조" / "3,580억" / "234만원" / "49개" 등 처리
            const m = tok.match(/^([\d,]+)([^\d,]+)$/);
            if (!m) {
              // 숫자+단위 패턴이 아니면 그냥 둠
              return tok;
            }
            const num = m[1];
            const unit = m[2];
            return (
              '<span class="money-number">' +
              num +
              '</span><span class="money-unit">' +
              unit +
              '</span>'
            );
          });

          node.innerHTML = htmlTokens.join(' ');
        });
      }

      // 공통: 자동 슬라이드 + hover 시 일시정지 + 드래그 스크롤
      function setupAutoSlider(trackSelector, viewportSelector, intervalMs) {
        const track = document.querySelector(trackSelector);
        const viewport = document.querySelector(viewportSelector);
        if (!track || !viewport) return;

        let index = 0;
        let timer = null;

        function slideOnce() {
          const cards = track.children;
          if (!cards.length) return;
          index = (index + 1) % cards.length;
          const target = cards[index];
          const offset = target.offsetLeft;
          viewport.scrollTo({ left: offset, behavior: 'smooth' });
        }

        function start() {
          if (timer) return;
          timer = setInterval(slideOnce, intervalMs);
        }

        function stop() {
          if (!timer) return;
          clearInterval(timer);
          timer = null;
        }

        // PC: 마우스 올리면 정지, 나가면 다시 재생
        viewport.addEventListener('mouseenter', stop);
        viewport.addEventListener('mouseleave', start);

        // 마우스 드래그로 좌우 이동 (특히 상품유형 패널 요구사항)
        let isDown = false;
        let startX = 0;
        let scrollLeft = 0;

        viewport.addEventListener('mousedown', (e) => {
          isDown = true;
          viewport.classList.add('is-dragging');
          startX = e.pageX - viewport.getBoundingClientRect().left;
          scrollLeft = viewport.scrollLeft;
          stop();
        });

        window.addEventListener('mouseup', () => {
          if (!isDown) return;
          isDown = false;
          viewport.classList.remove('is-dragging');
          start(); // 드래그 끝나면 다시 자동 슬라이드
        });

        viewport.addEventListener('mousemove', (e) => {
          if (!isDown) return;
          e.preventDefault();
          const x = e.pageX - viewport.getBoundingClientRect().left;
          const walk = startX - x;
          viewport.scrollLeft = scrollLeft + walk;
        });

        // 모바일 터치 드래그
        let tStartX = 0;
        let tScrollLeft = 0;
        viewport.addEventListener(
          'touchstart',
          (e) => {
            const touch = e.touches[0];
            tStartX = touch.pageX - viewport.getBoundingClientRect().left;
            tScrollLeft = viewport.scrollLeft;
            stop();
          },
          { passive: true }
        );

        viewport.addEventListener(
          'touchmove',
          (e) => {
            const touch = e.touches[0];
            const x = touch.pageX - viewport.getBoundingClientRect().left;
            const walk = tStartX - x;
            viewport.scrollLeft = tScrollLeft + walk;
          },
          { passive: false }
        );

        viewport.addEventListener(
          'touchend',
          () => {
            start();
          },
          { passive: true }
        );

        // 초기 자동 슬라이드 시작
        start();
      }

      // 슬라이더는 한 번만 세팅하면 되니까 플래그로 중복 방지
      let sliderInitialized = false;

      function initEnhance() {
        // 1) 매번 새 카드가 생길 때마다 숫자/단위 래핑
        decorateMoneySpans();

        // 2) 자동 슬라이더/드래그는 한 번만 세팅
        if (!sliderInitialized) {
          setupAutoSlider(
            '#ontuLoanTrack',
            '.stats-panel__slider--loan .stats-panel__viewport',
            3000
          );

          setupAutoSlider(
            '#ontuProductTrack',
            '.stats-panel__slider--products .stats-panel__viewport',
            3000
          );

          sliderInitialized = true;
        }
      }

      // ✅ ontu-stats.js 가 카드 렌더를 끝냈을 때마다 호출
      document.addEventListener('ontuStatsRendered', initEnhance);

      // 첫 로딩 직후(최신 월) 한 번 호출 – 혹시 이벤트가 먼저 발행되었을 경우 대비
      document.addEventListener('DOMContentLoaded', () => {
        initEnhance();
      });
    })();
  </script>
</body>
</html>
